| {% extends 'dillo/layout.pug' %}
| {% block bodyattrs %}{{ super() }} data-context='dashboard'{% endblock %}
| {% block page_title %}Dashboard{% endblock %}

| {% block body %}

#col_main.listing-list
	#list-hits

#col_right.listing-view
	#list-item
		.welcome
			h2 Welcome to Dillo

|{% endblock body %}

| {% block footer_scripts %}
script(src='https://cdn.jsdelivr.net/instantsearch.js/1/instantsearch.min.js')
script.
	var search = instantsearch({
		appId: '{{ config.ALGOLIA_USER }}',
		apiKey: '{{ config.ALGOLIA_PUBLIC_KEY }}',
		indexName: '{{ config.ALGOLIA_INDEX_NODES }}',
		urlSync: {}
	});

	search.addWidget(
		instantsearch.widgets.searchBox({
			container: '#q'
		})
	);


	{% raw %}
	var _hitTemplate =
		'<div class="hit media">' +
		'<div class="media-left">' +
		'<div class="media-object" style="background-image: url(\'{{picture}}\');"></div>' +
		'</div>' +
		'<div class="media-body">' +
		'<h4 class="media-heading">{{{_highlightResult.name.value}}} {{#stars}}<span class="ais-star-rating--star{{^.}}__empty{{/.}}"></span>{{/stars}}</h4>' +
		'<p class="year">{{year}}</p><p class="genre">{{#genre}}<span class="badge">{{.}}</span> {{/genre}}</p>' +
		'</div>' +
		'</div>';

	var hitTemplate =
		'<ul class="list-hits">' +
			'<li class="list-hits-item" data-id="{{ objectID }}">' +
				'<a href="" class="item-thumbnail js-item-show">' +
					'{{#picture}}<img src="{{picture}}"/>{{/picture}}{{^picture}}No Picture{{/picture}}' +
				'</a>' +
				'<div class="item-content">' +
					'<div class="item-rating-box">' +
						'<div class="item-rating up">' +
							'<i class="pi-angle-up"></i>' +
						'</div>' +
						'<div class="item-rating value">' +
							'12' +
						'</div>' +
						'<div class="item-rating down">' +
							'<i class="pi-angle-down"></i>' +
						'</div>' +
					'</div>' +
					'<div class="item-details">' +
						'<a href="" class="item-title js-item-show">{{{ name }}}</a>' +
						'<ul>' +
							'<li>' +
								'<a href="" class="js-item-show">' +
								'{{#is_link}}<img title="Link" src="http://www.google.com/s2/favicons?domain={{ description }}"/>{{/is_link}}' +
								'{{^is_link}}<i class="pi-document-text"></i>{{/is_link}}' +
								'</a>' +
							'</li>' +
							'<li><a href="">Tutorials</a></li>' +
							'<li><a href="">{{ created }}</a></li>' +
							'<li>{{ user.full_name }}</li>' +
							'<li><a href="">2 comments</a></li>' +
							'{{#is_link}}<li>{{ description }}</li>{{/is_link}}' +
						'</ul>' +
					'</div>' +
				'</div>' +
			'</li>' +
		'</ul>';


	var noResultsTemplate =
		'<div class="text-center">No results found matching <strong>{{query}}</strong>.</div>';
	{% endraw %}

	search.addWidget(
		instantsearch.widgets.hits({
			container: '#list-hits',
			hitsPerPage: 10,
			templates: {
				empty: noResultsTemplate,
				item: hitTemplate
			},
			transformData: function (hit) {
				hit.stars = [];
				for (var i = 1; i <= 5; ++i) {
					hit.stars.push(i <= hit.rating);
				};
				hit.created = moment.unix(hit.created).fromNow();
				hit.name = twemoji.parse(hit.name);

				return hit;
			}
		})
	);

	search.start();

	$('body').on('click', '.js-item-show', function(e){
		e.preventDefault();

		var li = $(this).parents('.list-hits-item');
		var hit_id = li.attr('data-id');

		/* Unstyle all items on the list and style only the current one */
		$('.list-hits-item').removeClass('active');
		li.addClass('active');

		item_open(hit_id);
	});

| {% endblock footer_scripts %}
