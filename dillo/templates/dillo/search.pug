| {% extends 'dillo/layout.pug' %}
| {% block bodyattrs %}{{ super() }} data-context='dashboard'{% endblock %}
| {% block page_title %}Dashboard{% endblock %}

| {% block body %}

#col_main.listing-list
	#list-hits

#col_right.listing-view

|{% endblock body %}

| {% block footer_scripts %}
script(src='https://cdn.jsdelivr.net/instantsearch.js/1/instantsearch.min.js')
script.
	var search = instantsearch({
		appId: '{{ config.ALGOLIA_USER }}',
		apiKey: '{{ config.ALGOLIA_PUBLIC_KEY }}',
		indexName: '{{ config.ALGOLIA_INDEX_NODES }}',
		urlSync: {}
	});

	search.addWidget(
		instantsearch.widgets.searchBox({
			container: '#q'
		})
	);


	{% raw %}
	var _hitTemplate =
		'<div class="hit media">' +
		'<div class="media-left">' +
		'<div class="media-object" style="background-image: url(\'{{picture}}\');"></div>' +
		'</div>' +
		'<div class="media-body">' +
		'<h4 class="media-heading">{{{_highlightResult.name.value}}} {{#stars}}<span class="ais-star-rating--star{{^.}}__empty{{/.}}"></span>{{/stars}}</h4>' +
		'<p class="year">{{year}}</p><p class="genre">{{#genre}}<span class="badge">{{.}}</span> {{/genre}}</p>' +
		'</div>' +
		'</div>';

	var hitTemplate =
		'<ul class="list-hits">' +
			'<li class="js-list-item">' +
				'<a href="" class="item-thumbnail">' +
					'{{#picture}}<img src="{{picture}}"/>{{/picture}}{{^picture}}No Picture{{/picture}}' +
				'</a>' +
				'<div class="item-content">' +
					'<div class="item-rating-box">' +
						'<div class="item-rating up">' +
							'<i class="pi-angle-up"></i>' +
						'</div>' +
						'<div class="item-rating value">' +
							'12' +
						'</div>' +
						'<div class="item-rating down">' +
							'<i class="pi-angle-down"></i>' +
						'</div>' +
					'</div>' +
					'<div class="item-details">' +
						'<a href="" class="item-title">{{{_highlightResult.name.value}}}</a>' +
						'<ul>' +
							'<li>' +
								'<img title="Link"' +
										' src="http://www.google.com/s2/favicons?domain=https://www.youtube.com">' +
							'</li>' +
							'<li><a href="">Tutorials</a></li>' +
							'<li><a href="">2 hours ago</a></li>' +
							'<li>{{ user.full_name }}</li>' +
							'<li><a href="">2 comments</a></li>' +
							'<li>youtube.com</li>' +
						'</ul>' +
					'</div>' +
				'</div>' +
			'</li>' +
		'</ul>';


	var noResultsTemplate =
		'<div class="text-center">No results found matching <strong>{{query}}</strong>.</div>';
	{% endraw %}

	search.addWidget(
		instantsearch.widgets.hits({
			container: '#list-hits',
			hitsPerPage: 10,
			templates: {
				empty: noResultsTemplate,
				item: hitTemplate
			},
			transformData: function (hit) {
				hit.stars = [];
				for (var i = 1; i <= 5; ++i) {
					hit.stars.push(i <= hit.rating);
				}
				return hit;
			}
		})
	);

	search.start();

| {% endblock footer_scripts %}
