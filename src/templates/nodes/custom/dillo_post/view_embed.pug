#item-media.item-media
	| {% if node.properties.post_type == 'link' and node.properties.content_html %}
	| {{ node.properties.content_html | safe }}
	| {% else %}
	| {% if node.picture %}
	img(src="{{ node.picture.thumbnail('l', api=api) }}")
	| {% endif %}
	| {% endif %}

.item-content(
	id="{{ node._id }}",
	data-node-id="{{ node._id }}")
	.item-rating-box(
		class="{% if node._current_user_rating is not none %}rated{% if node._current_user_rating %} positive{% else %} negative{% endif %}{% endif %}"
	)
		.item-rating.up
			i.pi-angle-up
		.item-rating.value {{ node.properties.rating_positive - node.properties.rating_negative }}
		.item-rating.down
			i.pi-angle-down
	.item-details
		a#item-title.item-title(href="") {{ node.name }}
		ul
			li#item-post_type {{ node.properties.post_type | undertitle }}
			li#item-category {{ node.properties.category | undertitle }}
			li {{ node._created | pretty_date }}
			li {{ node.user.full_name }}

			| {% if current_user.is_authenticated and (node.user._id == current_user.objectid) %}
			li
				a(href="{{ url_for('nodes.edit', node_id=node['_id']) }}") edit post
			| {% endif %}

			| {% if node.properties.post_type == 'link' %}
			li
				a#item-link-url(href="{{ node.description }}") {{ node.description }}
			| {% endif %}


| {% if node.properties.post_type == 'text' %}
.item-body#item-description
	| {{ node.properties.content_html | safe }}
| {% endif %}

#item-comments
	#comments-embed

script.
	document.addEventListener("DOMContentLoaded", function(event) {
		loadComments("{{ url_for('nodes.comments_for_node', node_id=node._id) }}");

		// Markdown initialization
		var convert = new Markdown.getSanitizingConverter();
		Markdown.Extra.init(convert);
		convert = convert.makeHtml;

		// Convert Markdown and emojis for text and title
		var $content = $('#item-description');
		$content.html(
			twemoji.parse(
				convert(
					$content.text()
				)
			)
		);
		$('#item-title').html(twemoji.parse('{{ node.name }}'));

		{% if node.properties.post_type == 'link' %}
			$('#item-link-url').text(shortenUrl('{{ node.description }}'));
		{% endif%}

	});
